# üèçÔ∏è SVC Moto - Sistema de Alquiler de Motos

üèçÔ∏è **Alquiler de motos y patinetes el√©ctricos en M√°laga**

Este es un proyecto de [Next.js](https://nextjs.org) para el alquiler de motocicletas con sistema de verificaci√≥n de c√≥digos.

## ‚ú® Funcionalidades Principales

### üîê Sistema de Verificaci√≥n de C√≥digos
- **Generaci√≥n autom√°tica** de c√≥digos de 6 d√≠gitos para cada reserva
- **Panel de administraci√≥n** para verificar c√≥digos 
- **Sistema de puntos** que se otorgan al verificar reservas
- **Historial completo** de reservas y verificaciones

### üéØ Caracter√≠sticas del Sistema
- Autenticaci√≥n con Google OAuth
- Base de datos PostgreSQL (Neon)
- Panel admin oculto y seguro
- Integraci√≥n con Mapbox para ubicaciones
- Chatbot con OpenAI
- Dise√±o responsive con Tailwind CSS

## üîÑ Variables de Entorno Requeridas

### **Para que funcione correctamente en Vercel, aseg√∫rate de tener estas variables:**

```env
# Base de datos PostgreSQL (Neon)
POSTGRES_PRISMA_URL=postgres://...
POSTGRES_URL_NON_POOLING=postgresql://...

# Autenticaci√≥n Google
GOOGLE_CLIENT_ID=your-client-id
GOOGLE_CLIENT_SECRET=your-secret

# OpenAI para chatbot
OPENAI_API_KEY=your-api-key

# Mapbox para mapas
NEXT_PUBLIC_MAPBOX_TOKEN=your-token

# JWT y seguridad
JWT_SECRET=your-jwt-secret
NEXTAUTH_SECRET=your-nextauth-secret
```

### ‚ö†Ô∏è **Importante**: 
Si falta `POSTGRES_PRISMA_URL`, la aplicaci√≥n no funcionar√°. Esta variable debe estar configurada exactamente con ese nombre en Vercel.

## üóÑÔ∏è Base de Datos - Neon PostgreSQL

### ¬øQu√© es Neon?
**Neon** es una plataforma de base de datos PostgreSQL serverless que ofrece:
- **Escalado autom√°tico**: Se adapta autom√°ticamente a la carga de trabajo
- **Branching**: Permite crear ramas de la base de datos para desarrollo
- **Conexiones pooling**: Optimiza las conexiones para mejor rendimiento
- **Backup autom√°tico**: Respaldos autom√°ticos y recuperaci√≥n point-in-time
- **Serverless**: Solo pagas por lo que usas, ideal para aplicaciones Next.js

### Configuraci√≥n de Neon
1. **Crear cuenta** en [neon.tech](https://neon.tech)
2. **Crear proyecto** PostgreSQL
3. **Obtener URLs** de conexi√≥n:
   - `POSTGRES_PRISMA_URL`: Para Prisma (con pooling)
   - `POSTGRES_URL_NON_POOLING`: Para conexiones directas
4. **Configurar variables** en Vercel/local

### Estructura de la Base de Datos

Nuestra aplicaci√≥n utiliza **6 tablas principales** con relaciones bien definidas:

#### üìã **Tabla: users**
**Prop√≥sito**: Almacena informaci√≥n de usuarios registrados
```sql
- id (String): ID √∫nico del usuario (CUID)
- email (String): Email √∫nico del usuario
- name (String?): Nombre del usuario (opcional)
- phone (String?): Tel√©fono del usuario (opcional)
- googleId (String?): ID de Google OAuth (√∫nico)
- picture (String?): URL de foto de perfil de Google
- authMethod (AuthMethod): EMAIL | GOOGLE
- isVerified (Boolean): Si el email est√° verificado
- lastLoginAt (DateTime?): √öltima fecha de login
- createdAt/updatedAt (DateTime): Timestamps
```
**Relaciones**: 
- Uno a muchos con `bookings`, `services`, `pointsLedger`, `discounts`

#### üèçÔ∏è **Tabla: bookings**
**Prop√≥sito**: Gestiona reservas de veh√≠culos (motos/patinetes)
```sql
- id (String): ID √∫nico de la reserva
- userId (String): Referencia al usuario
- vehicleType (String): "moto", "patinete", etc.
- vehicleId (String): ID espec√≠fico del veh√≠culo
- startAt/endAt (DateTime): Fechas de inicio y fin
- totalPrice (Float): Precio total de la reserva
- status (BookingStatus): Estado de la reserva
- verificationCode (String?): C√≥digo de 6 d√≠gitos √∫nico
- isVerified (Boolean): Si fue verificado por admin
- pointsAwarded (Int?): Puntos otorgados al completar
- estimatedKm/duration (Float?): Datos del viaje
- completedAt/cancelledAt (DateTime?): Fechas de estado
- notes (String?): Notas adicionales
```
**Estados posibles**:
- `PENDING`: Reserva creada, esperando verificaci√≥n
- `VERIFIED`: Verificada por admin, lista para usar
- `COMPLETED`: Completada y puntos otorgados
- `COMPLETED_NO_VERIFICATION`: Completada sin verificaci√≥n
- `CANCELLED`: Cancelada
- `EXPIRED`: Expirada sin usar

#### üéØ **Tabla: points_ledger**
**Prop√≥sito**: Registro contable de puntos (ganados/gastados)
```sql
- id (String): ID √∫nico del registro
- userId (String): Referencia al usuario
- bookingId (String?): Reserva relacionada (opcional)
- discountId (String?): Descuento relacionado (opcional)
- points (Int): Puntos (+ganados / -gastados)
- reason (String): "rental_completion", "bonus", "redemption"
- description (String?): Descripci√≥n adicional
- createdAt (DateTime): Fecha del movimiento
```
**Casos de uso**:
- **+12 puntos**: Por cada euro gastado
- **+100 puntos**: Bonus por completar alquiler
- **+200 puntos**: Por rese√±a positiva
- **-1875 puntos**: Canje por descuento 5‚Ç¨

#### üé´ **Tabla: discounts**
**Prop√≥sito**: C√≥digos de descuento generados con puntos
```sql
- id (String): ID √∫nico del descuento
- userId (String): Usuario que gener√≥ el descuento
- pointsUsed (Int): Puntos gastados para generarlo
- discountAmount (Float): Cantidad del descuento en euros
- discountCode (String): C√≥digo √∫nico de 6 d√≠gitos
- status (DiscountStatus): Estado del descuento
- validatedAt (DateTime?): Fecha de validaci√≥n
- validatedBy (String?): Admin que valid√≥
- expiresAt (DateTime): Fecha de expiraci√≥n
```
**Estados posibles**:
- `PENDING`: Generado, esperando validaci√≥n
- `VALIDATED`: Validado en tienda f√≠sica
- `EXPIRED`: Expirado
- `CANCELLED`: Cancelado

#### üõ†Ô∏è **Tabla: services**
**Prop√≥sito**: Solicitudes de servicios t√©cnicos (reparaci√≥n/mantenimiento)
```sql
- id (String): ID √∫nico del servicio
- userId (String): Usuario que solicita
- serviceType (String): "mantenimiento", "reparacion", etc.
- vehicleType (String?): Tipo de veh√≠culo
- description (String): Descripci√≥n del problema/servicio
- contactInfo (String): Email/tel√©fono de contacto
- preferredDate (DateTime?): Fecha preferida
- status (ServiceStatus): Estado del servicio
- estimatedPrice/finalPrice (Float?): Precios
- completedAt/cancelledAt (DateTime?): Fechas
- notes (String?): Notas del t√©cnico
- emailSent (Boolean): Si se envi√≥ confirmaci√≥n
```
**Estados posibles**:
- `PENDING`: Solicitado, esperando confirmaci√≥n
- `CONFIRMED`: Confirmado
- `IN_PROGRESS`: En progreso
- `COMPLETED`: Completado
- `CANCELLED`: Cancelado

### üîÑ Flujo de Datos Principal

1. **Usuario se registra** ‚Üí Se crea en `users`
2. **Hace una reserva** ‚Üí Se crea en `bookings` con `verificationCode`
3. **Admin verifica** ‚Üí `booking.status` = `VERIFIED`
4. **Usuario completa viaje** ‚Üí `booking.status` = `COMPLETED`
5. **Sistema otorga puntos** ‚Üí Se crean registros en `points_ledger`
6. **Usuario canjea puntos** ‚Üí Se crea `discount` y registro negativo en `points_ledger`
7. **Usuario usa descuento** ‚Üí `discount.status` = `VALIDATED`

### üîß Comandos √ötiles de Prisma

```bash
# Generar cliente Prisma
npx prisma generate

# Aplicar migraciones
npx prisma db push

# Ver base de datos
npx prisma studio

# Reset completo (¬°CUIDADO!)
npx prisma db reset

# Crear migraci√≥n
npx prisma migrate dev --name nombre_migracion
```

### üìä Consultas Comunes

```typescript
// Obtener puntos totales de un usuario
const totalPoints = await prisma.pointsLedger.aggregate({
  where: { userId },
  _sum: { points: true }
})

// Historial de reservas completadas
const completedBookings = await prisma.booking.findMany({
  where: { 
    userId,
    status: { in: ['COMPLETED', 'VERIFIED'] }
  },
  include: { pointsLedger: true }
})

// Descuentos v√°lidos del usuario
const validDiscounts = await prisma.discount.findMany({
  where: {
    userId,
    status: 'PENDING',
    expiresAt: { gt: new Date() }
  }
})
```

---

**üöÄ Deploy actualizado - Variables de entorno configuradas correctamente**

Plataforma web completa de SVC MOTO, empresa l√≠der en alquiler de veh√≠culos el√©ctricos y servicios de reparaci√≥n y mantenimiento en M√°laga. Incluye sistema de usuarios, rutas tur√≠sticas interactivas, y experiencia multiidioma.

## üìã Descripci√≥n

SVC MOTO es una plataforma integral que permite a los usuarios explorar M√°laga de forma sostenible mediante el alquiler de motos y patinetes el√©ctricos. Nuestro sitio web ofrece una experiencia completa con autenticaci√≥n de usuarios, sistema de puntos, rutas tur√≠sticas guiadas, y gesti√≥n completa de reservas.

## ‚ú® Caracter√≠sticas Implementadas

### üè† P√°gina Principal
- **Hero Section** con video de introducci√≥n y animaciones
- **Estad√≠sticas** de la empresa (valoraciones, seguridad, eco-friendly)
- **Proceso de alquiler** explicado paso a paso con iconograf√≠a
- **Navegaci√≥n** intuitiva y completamente responsive
- **Secci√≥n de contacto** integrada con video de fondo
- **Footer** completo con enlaces y redes sociales

### üèçÔ∏è P√°gina de Alquiler
- **Cat√°logo interactivo** de veh√≠culos con especificaciones detalladas
- **Sistema de precios** din√°mico (hora, medio d√≠a, d√≠a completo, semanal)
- **Modal de detalles** para cada veh√≠culo con caracter√≠sticas completas
- **Simulador de reservas** con gesti√≥n de estado local
- **Tres tipos de veh√≠culos** completamente configurados:
  - Urban Rider Pro (Scooter El√©ctrico)
  - City Explorer (Moto El√©ctrica) 
  - Eco Cruiser (Patinete El√©ctrico)
- **Proceso de reserva** paso a paso con validaciones

### üõ†Ô∏è P√°gina de Servicios
- **Cat√°logo completo** de servicios t√©cnicos
- **Modal interactivo** para solicitud de servicios
- **Servicios especializados** con precios y descripciones:
  - Reparaci√≥n General
  - Cambio de Bater√≠a
  - Mantenimiento Preventivo
  - Diagn√≥stico T√©cnico
  - Servicio Express
- **Formulario de solicitud** con validaciones
- **Garant√≠as y certificaciones** incluidas

### üìç P√°gina de Contacto
- **Mapa interactivo Mapbox** con ubicaci√≥n precisa
- **Sistema de rutas tur√≠sticas** con pathfinding real:
  - Ruta 1: Centro Hist√≥rico (Catedral, Alcazaba, Museo Picasso)
  - Ruta 2: Playa y Puerto (Muelle Uno, Malagueta, Puerto)
  - Ruta 3: Mirador y Castillo (Gibralfaro, Mirador, Parador)
- **Formulario de contacto** completamente funcional
- **Informaci√≥n de contacto** completa con horarios
- **Tarjeta de rese√±as Google** integrada
- **Botones de contacto r√°pido** (WhatsApp, llamada)

### üë§ P√°gina de Perfil de Usuario
- **Autenticaci√≥n completa** con Google OAuth
- **Dashboard personalizado** con estad√≠sticas del usuario
- **Sistema de puntos** gamificado con recompensas:
  - Puntos por alquileres completados
  - Sistema de niveles y logros
  - 22 logros diferentes desbloqueables
  - Recompensas por puntos acumulados
- **Historial de alquileres** con detalles completos
- **Gesti√≥n de informaci√≥n personal** editable
- **Estad√≠sticas ambientales** (CO2 ahorrado, km recorridos)

### üîê Sistema de Autenticaci√≥n
- **Google OAuth** integrado y funcional
- **Gesti√≥n de sesiones** persistente
- **Estados de autenticaci√≥n** en toda la aplicaci√≥n
- **Protecci√≥n de rutas** para contenido de usuarios
- **Modal de bienvenida** para nuevos usuarios

### üåç Sistema Multiidioma
- **Soporte completo** para Espa√±ol e Ingl√©s
- **Contexto de traducciones** centralizado
- **Toggle de idioma** en toda la aplicaci√≥n
- **M√°s de 200 traducciones** implementadas
- **Persistencia de preferencia** de idioma

## üõ†Ô∏è Stack Tecnol√≥gico

### Frontend
- **Framework**: Next.js 14 (App Router)
- **Lenguaje**: TypeScript
- **Estilos**: Tailwind CSS
- **Componentes UI**: shadcn/ui
- **Iconos**: Lucide React
- **Fuentes**: Geist Sans & Geist Mono

### Mapas y Geolocalizaci√≥n
- **Mapas**: Mapbox GL JS
- **API de Rutas**: Mapbox Directions API
- **Pathfinding**: Algoritmos de navegaci√≥n real
- **Geocodificaci√≥n**: Coordenadas precisas de M√°laga

### Autenticaci√≥n y Datos
- **OAuth**: Google Authentication
- **Gesti√≥n de Estado**: React Hooks (useState, useEffect, useContext)
- **Persistencia**: LocalStorage para datos de usuario
- **Contextos**: React Context API para traducciones

### Herramientas de Desarrollo
- **Linting**: ESLint
- **Formateo**: Prettier (impl√≠cito)
- **Build**: Next.js optimizado
- **Deployment**: Vercel ready

## üöÄ Instalaci√≥n y Desarrollo

### Prerrequisitos
- Node.js 18+ 
- npm, yarn o pnpm

### Instalaci√≥n
```bash
# Clonar el repositorio
git clone https://github.com/420btc/svcmoto.git
cd svcmoto

# Instalar dependencias
npm install
# o
yarn install
# o
pnpm install
```

### Desarrollo
```bash
# Iniciar servidor de desarrollo
npm run dev
# o
yarn dev
# o
pnpm dev
```

Abrir [http://localhost:3000](http://localhost:3000) en el navegador.

### Build para Producci√≥n
```bash
# Crear build optimizado
npm run build
npm start
```

## üöÄ Funcionalidades Avanzadas

### üó∫Ô∏è Sistema de Rutas Tur√≠sticas
- **3 rutas predefinidas** por sitios emblem√°ticos de M√°laga
- **Pathfinding real** usando Mapbox Directions API
- **Navegaci√≥n calle por calle** (no l√≠neas rectas)
- **Visualizaci√≥n interactiva** con l√≠neas naranjas
- **Punto de partida y llegada** en la tienda
- **Descripciones detalladas** de cada ruta

### üéÆ Sistema de Gamificaci√≥n
- **22 logros √∫nicos** desbloqueables:
  - Primer Viaje, Explorador, Eco Principiante
  - Frecuente, Aventurero, Eco Consciente
  - Habitual, Viajero, Eco Defensor, Veterano
  - N√≥mada, Eco H√©roe, Experto, Explorador Urbano
  - Eco Warrior, Maestro, Velocista, Maratonista
  - Eco Leyenda, S√∫per Viajero, Centuri√≥n, Eco Dios
- **Sistema de puntos** por actividades
- **Niveles de recompensas** con descuentos
- **Estad√≠sticas ambientales** personalizadas

### üì± Experiencia M√≥vil Optimizada
- **Dise√±o 100% responsive** en todas las p√°ginas
- **Navegaci√≥n m√≥vil** con men√∫ hamburguesa
- **Modales adaptables** para pantallas peque√±as
- **Botones de contacto directo** (WhatsApp, llamada)
- **Optimizaci√≥n de formularios** para m√≥vil

## üîÆ Roadmap Futuro

### üìß Backend Integration
- **API REST** para gesti√≥n de datos
- **Base de datos** para usuarios y reservas
- **EmailJS** para notificaciones autom√°ticas
- **Sistema de pagos** integrado

### üîê Panel de Administraci√≥n
- **Dashboard administrativo** para gesti√≥n de flota
- **Gesti√≥n de reservas** en tiempo real
- **Analytics avanzados** de uso y rendimiento
- **Sistema de inventario** de veh√≠culos

### üåü Mejoras UX/UI
- **Modo oscuro** autom√°tico
- **Chatbot con IA** para atenci√≥n 24/7
- **Sistema de valoraciones** y rese√±as
- **Notificaciones push** web

### üîå Integraciones Adicionales
- **Google Analytics 4** para m√©tricas detalladas
- **WhatsApp Business API** para soporte automatizado
- **Integraci√≥n con redes sociales** para compartir rutas
- **API de clima** para recomendaciones de rutas

## üìÅ Estructura del Proyecto

```
svc-moto-landing/
‚îú‚îÄ‚îÄ app/                    # App Router de Next.js
‚îÇ   ‚îú‚îÄ‚îÄ alquiler/          # P√°gina de alquiler con cat√°logo
‚îÇ   ‚îú‚îÄ‚îÄ api/               # API routes
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth/          # Endpoints de autenticaci√≥n
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ chat/          # Endpoints para chatbot
‚îÇ   ‚îú‚îÄ‚îÄ contacto/          # P√°gina de contacto con rutas
‚îÇ   ‚îú‚îÄ‚îÄ handler/           # Manejadores de autenticaci√≥n
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ [...stack]/    # Stack Auth handlers
‚îÇ   ‚îú‚îÄ‚îÄ perfil/            # P√°gina de perfil de usuario
‚îÇ   ‚îú‚îÄ‚îÄ reservas/          # Gesti√≥n de reservas
‚îÇ   ‚îú‚îÄ‚îÄ servicios/         # P√°gina de servicios t√©cnicos
‚îÇ   ‚îú‚îÄ‚îÄ globals.css        # Estilos globales
‚îÇ   ‚îú‚îÄ‚îÄ layout.tsx         # Layout principal con navegaci√≥n
‚îÇ   ‚îú‚îÄ‚îÄ page.tsx           # P√°gina de inicio
‚îÇ   ‚îî‚îÄ‚îÄ sitemap.ts         # Sitemap para SEO
‚îú‚îÄ‚îÄ components/            # Componentes reutilizables
‚îÇ   ‚îú‚îÄ‚îÄ ui/               # Componentes de shadcn/ui (40+ componentes)
‚îÇ   ‚îú‚îÄ‚îÄ ChatBot.tsx       # Componente de chatbot
‚îÇ   ‚îú‚îÄ‚îÄ LanguageToggle.tsx # Toggle de idiomas
‚îÇ   ‚îî‚îÄ‚îÄ theme-provider.tsx # Proveedor de temas
‚îú‚îÄ‚îÄ contexts/             # Contextos de React
‚îÇ   ‚îî‚îÄ‚îÄ TranslationContext.tsx # Sistema de traducciones
‚îú‚îÄ‚îÄ hooks/                # Custom hooks
‚îÇ   ‚îú‚îÄ‚îÄ use-mobile.ts     # Hook para detecci√≥n m√≥vil
‚îÇ   ‚îî‚îÄ‚îÄ use-toast.ts      # Hook para notificaciones
‚îú‚îÄ‚îÄ lib/                  # Utilidades
‚îÇ   ‚îî‚îÄ‚îÄ utils.ts          # Funciones de utilidad
‚îú‚îÄ‚îÄ public/               # Archivos est√°ticos
‚îÇ   ‚îú‚îÄ‚îÄ Video2.mp4        # Videos de fondo
‚îÇ   ‚îú‚îÄ‚îÄ Video3.mp4
‚îÇ   ‚îú‚îÄ‚îÄ herovideo.mp4
‚îÇ   ‚îú‚îÄ‚îÄ logo-svcmoto.jpeg # Logo de la empresa
‚îÇ   ‚îî‚îÄ‚îÄ *.svg             # Iconos y placeholders
‚îú‚îÄ‚îÄ styles/               # Estilos adicionales
‚îÇ   ‚îî‚îÄ‚îÄ globals.css       # Estilos CSS globales
‚îú‚îÄ‚îÄ components.json       # Configuraci√≥n de shadcn/ui
‚îú‚îÄ‚îÄ next.config.mjs       # Configuraci√≥n de Next.js
‚îú‚îÄ‚îÄ package.json          # Dependencias del proyecto
‚îú‚îÄ‚îÄ tailwind.config.ts    # Configuraci√≥n de Tailwind
‚îî‚îÄ‚îÄ tsconfig.json         # Configuraci√≥n de TypeScript
```

## üìä Estad√≠sticas del Proyecto

- **P√°ginas**: 5 p√°ginas principales completamente funcionales
- **Componentes**: 40+ componentes UI reutilizables
- **Traducciones**: 200+ strings traducidos (ES/EN)
- **Rutas tur√≠sticas**: 3 rutas con pathfinding real
- **Logros**: 22 achievements √∫nicos
- **L√≠neas de c√≥digo**: 2000+ l√≠neas de TypeScript/TSX
- **Responsive**: 100% compatible m√≥vil/desktop
- **Performance**: Optimizado para Core Web Vitals



## üéØ Caracter√≠sticas Destacadas

### üî• Innovaciones Implementadas
- **Rutas tur√≠sticas interactivas** con navegaci√≥n real
- **Sistema de gamificaci√≥n** completo con 22 logros
- **Autenticaci√≥n social** con Google OAuth
- **Multiidioma** din√°mico (ES/EN)
- **Mapas avanzados** con Mapbox y pathfinding
- **Experiencia m√≥vil** optimizada al 100%
- **Sistema de puntos** y recompensas
- **Dashboard de usuario** personalizado

### üèÜ Logros T√©cnicos
- **Performance**: Optimizado para Core Web Vitals
- **SEO**: Sitemap y meta tags optimizados
- **Accessibility**: Componentes accesibles
- **TypeScript**: 100% tipado est√°tico
- **Responsive**: Mobile-first design
- **Modern Stack**: Next.js 14 + React 18

## üìû Informaci√≥n de Contacto

### üè¢ SVC MOTO
- **Tel√©fono**: 607 22 88 82
- **WhatsApp**: 607 22 88 82
- **Direcci√≥n**: C. H√©roe de Sostoa, 37, Carretera de C√°diz, 29002 M√°laga
- **Horario**: Lunes a Viernes 10:00-19:00
- **Email**: info@svcmoto.com

### üë®‚Äçüíª Desarrollo
- **Desarrollador**: Carlos Freire
- **Portfolio**: [Carlosfr.es](https://carlosfr.es)
- **GitHub**: [420btc](https://github.com/420btc)
- **Tecnolog√≠as**: Next.js, TypeScript, Tailwind CSS

## üöÄ Deployment

### Vercel (Recomendado)
```bash
# Deploy autom√°tico con Vercel
vercel --prod
```

### Variables de Entorno
```env
NEXT_PUBLIC_MAPBOX_TOKEN=tu_token_de_mapbox
GOOGLE_CLIENT_ID=tu_google_client_id
GOOGLE_CLIENT_SECRET=tu_google_client_secret
```

## üìÑ Licencia

Este proyecto es propiedad de **SVC MOTO**. Todos los derechos reservados.

**Desarrollado con ‚ù§Ô∏è por [Carlos Freire](https://carlosfr.es)**

---

**SVC MOTO** - *Explora M√°laga de forma sostenible* üå±üèçÔ∏è

*Plataforma completa de movilidad el√©ctrica con rutas tur√≠sticas interactivas*